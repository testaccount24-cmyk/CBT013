*          DATA SET CBT1428    AT LEVEL 001 AS OF 03/27/83
*    PROGRAM STARTS ABOUT 155 LINES DOWN                                00001
         MACRO                                                          00002
&NAME    SAVEALL &RENT,&REG=3,&EQU=YES,&ID=NO                           00003
         GBLB  &SAVRENT                                                 00004
         GBLB  &REGSW                                                   00005
         GBLB  &TIME                                                    00006
         GBLC  &SAVNDX                                                  00007
&SAVNDX  SETC  '&SYSNDX'                                                00008
&NAME    CSECT                                                          00009
         AIF   ('&SAVRENT' EQ '1').NOTFREE                              00010
         AIF   ('&REGSW' EQ '1').NOEQU                                  00011
         AIF   ('&EQU' NE 'YES').NOEQU                                  00012
&REGSW   SETB  1                                                        00013
         SPACE                                                          00014
*********************************************************************** 00015
********           DEFINITION OF GENERAL REGISTERS             ******** 00016
*********************************************************************** 00017
R0       EQU   0    GENERAL REGISTER ZERO                               00018
R1       EQU   1    GENERAL REGISTER ONE                                00019
R2       EQU   2    GENERAL REGISTER TWO                                00020
R3       EQU   3    GENERAL REGISTER THREE                              00021
R4       EQU   4    GENERAL REGISTER FOUR                               00022
R5       EQU   5    GENERAL REGISTER FIVE                               00023
R6       EQU   6    GENERAL REGISTER SIX                                00024
R7       EQU   7    GENERAL REGISTER SEVEN                              00025
R8       EQU   8    GENERAL REGISTER EIGHT                              00026
R9       EQU   9    GENERAL REGISTER NINE                               00027
R10      EQU   10   GENERAL REGISTER TEN                                00028
R11      EQU   11   GENERAL REGISTER ELEVEN                             00029
R12      EQU   12   GENERAL REGISTER TWELVE                             00030
R13      EQU   13   GENERAL REGISTER THIRTEEN                           00031
R14      EQU   14   GENERAL REGISTER FOURTEEN                           00032
R15      EQU   15   GENERAL REGISTER FIFTEEN                            00033
         SPACE                                                          00034
RA       EQU   10   GENERAL REGISTER TEN                                00035
RB       EQU   11   GENERAL REGISTER ELEVEN                             00036
RC       EQU   12   GENERAL REGISTER TWELVE                             00037
RD       EQU   13   GENERAL REGISTER THIRTEEN                           00038
RE       EQU   14   GENERAL REGISTER FOURTEEN                           00039
RF       EQU   15   GENERAL REGISTER FIFTEEN                            00040
*********************************************************************** 00041
********             END OF REGISTER DEFINITIONS               ******** 00042
*********************************************************************** 00043
         SPACE                                                          00044
.NOEQU   ANOP                                                           00045
         SAVE  (14,12)                                                  00046
         AIF   ('&REG' EQ '').MESS                                      00047
         BALR  &REG(1),0                                                00048
         AIF   (N'&REG EQ 1).A                                          00049
         AIF   (N'&REG EQ 2).B                                          00050
         AIF   (N'&REG EQ 3).C                                          00051
         AIF   (N'&REG EQ 4).D                                          00052
         AIF   (N'&REG EQ 5).E                                          00053
         MNOTE *****,'EXCESSIVE BASE REGISTERS -- 5 ASSUMED *****'      00054
         AGO   .E                                                       00055
.MESS    MNOTE 12,'***** NO BASE REGISTER SPECIFIED *****'              00056
         MEXIT                                                          00057
.NOTFREE MNOTE 12,'***** ENDALL NOT ISSUED PRIOR TO NEW SAVEALL *****'  00058
         MEXIT                                                          00059
.E       USING *,&REG(1),&REG(2),&REG(3),&REG(4),&REG(5)                00060
Q&SYSNDX L     &REG(2),=A(Q&SYSNDX+4096)     LOAD BASE REGISTERS        00061
         L     &REG(3),=A(Q&SYSNDX+8192)                                00062
         L     &REG(4),=A(Q&SYSNDX+12288)                               00063
         L     &REG(5),=A(Q&SYSNDX+16384)                               00064
         AGO   .END                                                     00065
.D       USING *,&REG(1),&REG(2),&REG(3),&REG(4)                        00066
Q&SYSNDX L     &REG(2),=A(Q&SYSNDX+4096)     LOAD BASE REGISTERS        00067
         L     &REG(3),=A(Q&SYSNDX+8192)                                00068
         L     &REG(4),=A(Q&SYSNDX+12288)                               00069
         AGO   .END                                                     00070
.C       USING *,&REG(1),&REG(2),&REG(3)                                00071
Q&SYSNDX L     &REG(2),=A(Q&SYSNDX+4096)     LOAD BASE REGISTERS        00072
         L     &REG(3),=A(Q&SYSNDX+8192)                                00073
         AGO   .END                                                     00074
.B       USING *,&REG(1),&REG(2)                                        00075
Q&SYSNDX L     &REG(2),=A(Q&SYSNDX+4096)     LOAD BASE REGISTER         00076
         AGO   .END                                                     00077
.A       USING *,&REG(1)                                                00078
.END     ANOP                                                           00079
         AIF   ('&RENT' NE 'RENT').NORENT                               00080
&SAVRENT SETB  1                                                        00081
         GETMAIN R,LV=4096         GET STORAGE FOR SAVE AREA            00082
         ST    13,4(1)             SET UP FORWARD CHAIN                 00083
         ST    1,8(13)             SET UP BACKWARD CHAIN                00084
         L     0,20(0,13)          RESET REGISTER 0                     00085
         L     1,24(0,13)          RESET REGISTER 1                     00086
         L     13,8(0,13)          LOAD SAVE AREA ADDRESS               00087
         B     J&SYSNDX           BRANCH AROUND LTORG                   00088
         AGO   .RENT                                                    00089
.NORENT  ANOP                                                           00090
&TIME    SETB  1                                                        00091
         ST    13,SAVE&SYSNDX+4    SET UP FORWARD CHAIN                 00092
         LA    1,SAVE&SYSNDX                                            00093
         ST    1,8(0,13)           SET UP BACKWARD CHAIN                00094
         L     1,24(0,13)          RESET REGISTER 1                     00095
         LA    13,SAVE&SYSNDX                                           00096
         B     J&SYSNDX           BRANCH AROUND BASE REGISTER CONST     00097
SAVE&SYSNDX DC 18F'0'                                                   00098
.RENT    ANOP                                                           00099
         LTORG                                                          00100
         AIF   ('&ID' NE 'YES').NOID                                    00101
         DC    CL8'&SYSDATE'                                            00102
         DC    CL8'&SYSTIME'                                            00103
.NOID    ANOP                                                           00104
J&SYSNDX DS    0H                                                       00105
         MEND                                                           00106
         MACRO                                                          00107
&NAME    ENDALL &CODE=                                                  00108
         GBLB  &TIME                                                    00109
         GBLB  &SAVRENT                                                 00110
         GBLC  &SAVNDX                                                  00111
         LCLA  &LEN                                                     00112
         LCLC  &REG                                                     00113
         AIF   ('&CODE' GT '4095').INVRET                               00114
&NAME    DS    0H                                                       00115
         AIF   (K'&CODE LE 0).CHKRENT                                   00116
         AIF   ('&CODE'(1,1) NE '(').CHKRENT                            00117
         AIF   ('&CODE' EQ '(13)' OR '&CODE' EQ '(14)').INVREG          00118
         AIF   ('&CODE' EQ '(0)' OR '&CODE' EQ '(1)').INVREG            00119
         AIF   ('&CODE' NE '(15)').CHKRENT                              00120
         LR    2,15               SAVE REG 15 RETURN CODE               00121
.CHKRENT AIF   (NOT &SAVRENT).NOTRENT                                   00122
&SAVRENT SETB  0                                                        00123
         LR    1,13               LOAD SAVE AREA ADDRESS                00124
         L     13,4(0,13)         RE-LOAD REGISTER 13                   00125
         FREEMAIN R,LV=4096,A=(1) FREE SAVE AREA STORAGE                00126
         AGO   .RENT                                                    00127
.NOTRENT ANOP                                                           00128
         AIF   (NOT &TIME).NOSAVE                                       00129
&TIME    SETB  0                                                        00130
         L     13,SAVE&SAVNDX+4   RE-LOAD REGISTER 13                   00131
.RENT    ANOP                                                           00132
         AIF   ('&CODE' EQ '').COND1                                    00133
         AIF   ('&CODE' NE '(15)').CHKREG                               00134
         LR    15,2               GET RETURN CODE BACK FROM R2          00135
         AGO   .ENDIT                                                   00136
.CHKREG  AIF   ('&CODE'(1,1) NE '(').NOTREG                             00137
&LEN     SETA  K'&CODE-2                                                00138
&REG     SETC  '&CODE'(2,&LEN)                                          00139
         LR    15,&REG            GET RETURN CODE                       00140
         AGO   .ENDIT                                                   00141
.NOTREG  ANOP                                                           00142
         LA    15,&CODE           LOAD CODE TO REG 15                   00143
         AGO   .ENDIT                                                   00144
.INVRET  MNOTE 12,'***** RETURN CODE PASSED GREATER THAN 4095 *****'    00145
         MEXIT                                                          00146
.NOSAVE  MNOTE 12,'***** SAVEALL NOT ISSUED PRIOR TO ENDALL *****'      00147
         MEXIT                                                          00148
.INVREG  MNOTE 12,'***** INVALID REGISTER USED FOR RETURN CODE "&CODE"' 00149
         MEXIT                                                          00150
.COND1   LA    15,0               LOAD ZERO (NO CODE) TO REG 15         00151
.ENDIT   ANOP                                                           00152
         RETURN     (14,12),T,RC=(15)                                   00153
         MEND                                                           00154
*          DATA SET DEDIOS     AT LEVEL 001 AS OF 03/24/83              00155
*********************************************************************   00156
*********************************************************************   00157
**                                                                 **   00158
**       THIS PROGRAM HAS TO RUN APF AUTHORIZED.                   **   00159
**                                                                 **   00160
**       CONDITIONALLY FIX DSCB VOLSER IN DSCB, OR                 **   00161
**       TURN RACF BITS ON OR OFF.                                 **   00162
**                                                                 **   00163
**       VALID PARMS ARE:                                          **   00164
**                                                                 **   00165
**       PARM='CUA,VOLSER' FIX VOLSER ALL VOLSERS IF WRONG         **   00166
**       PARM='CUA,RACFON' TURN ALL RACF BITS ON                   **   00167
**       PARM='CUA,NORACF' TURN ALL RACF BITS OFF                  **   00168
**                                                                 **   00169
**       * NOTE * WITH PARMS RACFON AND NORACF VSAM WILL NOT       **   00170
**                BE TOUCHED.                                      **   00171
**                                                                 **   00172
**       WHERE CUA = DEVICE ADDRESS OF VOLUME TO BE CHANGED        **   00173
**                                                                 **   00174
**       SAMPLE JCL.                                               **   00175
**       //TEC107   EXEC PGM=TEC107,PARM='100,NORACF'              **   00176
**       //STEPLIB  DD   DSN=AUTHORIZED.LIBRARY,DISP=SHR           **   00177
**       //SYSPRINT DD   SYSOUT=1                                  **   00178
**                                                                 **   00179
**-----------------------------------------------------------------**   00180
** CHANGES:  ENABLED PROGRAM TO RUN IN AN MVS/XA ENVIRONMENT       **   00180
**              09/03/86                                           **   00180
**                                                                 **   00180
**                                                                 **   00180
**                                                                 **   00180
**                                                                 **   00181
*********************************************************************   00182
*********************************************************************   00183
TEC107   SAVEALL REG=(12)                                               00184
         EJECT                                                          00185
*********************************************************************   00186
*********************************************************************   00187
**                                                                 **   00188
**       CHECK FOR VALID PARM.                                     **   00189
**                                                                 **   00190
*********************************************************************   00191
*********************************************************************   00192
         SPACE                                                          00193
         L     R2,0(R1)                ADDRESS OF PARM FIELD            00194
         LH    R9,0(R2)                LENGTH                           00195
         LTR   R9,R9                   IS THERE A PARM?                 00196
         BZ    NOPARM                      NO.. GET OUT                 00197
         CLC   0(2,R2),=XL2'000A'     LENGTH 10?                        00198
         BNE   BADPARM                    NO - BAD PARM                 00199
         CLC   6(6,R2),=C'VOLSER'      FIX VOLSER IN DSCB?              00200
         BE    PARM1                      YES.. CONTINUE                00201
         CLC   6(6,R2),=C'RACFON'      TURN ON RACF BIT IN DSCB?        00202
         BE    PARM2                      YES.. CONTINUE                00203
         CLC   6(6,R2),=C'NORACF'      TURN OFF RACF NIT IN DSCB?       00204
         BE    PARM3                      YES.. CONTINUE                00205
         B     BADPARM                    NO... PARM INVALID            00206
         SPACE                                                          00207
PARM1    MVI   FLAG,C'1'               SET FIX DSCB VOLSER              00208
         B     START                                                    00209
PARM2    MVI   FLAG,C'2'               SET RACF BIT ON                  00210
         B     START                                                    00211
PARM3    MVI   FLAG,C'3'               SET RACF OFF                     00212
         B     START                                                    00213
         EJECT                                                          00214
*********************************************************************   00215
*********************************************************************   00216
**                                                                 **   00217
**       GET DEVICE ADDRESS AND COVERT IT TO HEX FOR IOSLOOK       **   00218
**                                                                 **   00219
*********************************************************************   00220
*********************************************************************   00221
         SPACE                                                          00222
START    OPEN  (SYSPRINT,(OUTPUT))     OPEN PRINT FILE                  00223
         MVC   ADDRWRK(3),2(R2)        GET DEVICE ADDRESS               00224
         TR    ADDRWRK,HEX             CONVERT EACH BYTE TO HEX         00225
         IC    R4,ADDRWRK+1            GET UNIT ADDRESS                 00226
         SLL   R4,4                    SHIFT LEFT 4 BITS                00227
         STC   R4,ADDRWRK+1            AND RESTORE                      00228
         OC    ADDRWRK+2(1),ADDRWRK+1  'OR' OVER DEVICE ADDRESS         00229
         MVC   ADDRWRK+1(1),ADDRWRK    MOVE CHANNEL ADDRESS RIGHT       00230
         MVI   ADDRWRK,X'00'           ZERO OUT HIGH ORDER BYTE         00231
         SR    R4,R4                   RESET R4                         00232
         ICM   R4,7,ADDRWRK            GET DEVICE ADDRESS (HEX)         00233
         EJECT                                                          00234
*********************************************************************   00235
*********************************************************************   00236
**                                                                 **   00237
**       GET INTO SUPERVISOR MODE KEY 0 AND DO AN IOSLOOK TO       **   00238
**       FIND THE UCB ADDRESS FOR CVAF.                            **   00239
**                                                                 **   00240
*********************************************************************   00241
*********************************************************************   00242
         SPACE                                                          00243
SETSUP   MODESET MODE=SUP,KEY=ZERO     GO TO SUPERVISOR STATE AND KEY 0 00244
         SPACE                                                          00245
IOSLOOK  ST    R13,SAVE13              SAVE MY REG 13                   00246
         LA    R13,IOSSAVE             POINT TO IOS SAVE AREA           00247
         IOSLOOK DEV=(4),UCB=(5)       RETURN UCB ADDRESS IN R5         00248
         SPACE                                                          00249
         L     R13,SAVE13              RESTORE REG 13                   00250
         MODESET MODE=PROB,KEY=NZERO   RESET TO PROBLEM STATE AND KEY   00251
         LTR   R15,R15                 VALID DEVICE?                    00252
         BNZ   BADUCB                     NO...END                      00253
         EJECT                                                          00254
*********************************************************************   00255
*********************************************************************   00256
**                                                                 **   00257
**       HAVE A VALID UCB IS IT A BLANK VOLSER?                    **   00258
**                                                                 **   00259
*********************************************************************   00260
*********************************************************************   00261
         SPACE                                                          00262
         USING UCBOB,R5                                                 00263
GOTUCB   CLC   UCBVOLI,=XL6'00'        BLANK VOLSER?                    00264
         BNE   UNITTST                   NO...CONTINUE                  00265
         WTO   'BLANK UCB',ROUTCDE=(11)  YES..                          00266
         L     R15,8                   SET BAD RETURN CODE              00267
         B     EOF                            AND RETURN                00268
         EJECT                                                          00269
*********************************************************************   00270
*********************************************************************   00271
**                                                                 **   00272
**       CHECK TO SEE IF INDEXED OR NON-INDEXED VTOC               **   00273
**       AND BRANCH TO APPROPRIATE ROUTINE.                        **   00274
**                                                                 **   00275
*********************************************************************   00276
*********************************************************************   00277
         SPACE                                                          00278
UNITTST  CLC   UCBNAME(3),2(R2)        RIGHT UCB?                       00279
         BE    CVAFTST                                                  00280
         ABEND 1,DUMP                                                   00281
         SPACE                                                          00282
CVAFTST  MVC   PVOL,UCBVOLI            PUT VOLSER IN PRINT LINE         00283
         MVC   PUNIT(3),2(R2)          PUT UNIT IN PRINT LINE           00284
         MVC   PPARM(6),6(R2)          PUT PARM IN PRINT LINE           00285
         MVC   VOLUME,UCBVOLI          GET VOLSER FOR ENQ/DEQ           00286
         CVAFTST UCB=(R5)              INDEXED VTOC?                    00287
         SPACE                                                          00288
         B     TSTRTN(R15)             BRANCH TO APPROPRIATE ROUTINE    00289
TSTRTN   DS    0H                                                       00290
         B     NOINDEX                 RC 0 - NO DF/DS UNINDEXED        00291
         B     NOINDEX                 RC 4 - NO INDEXED VTOC           00292
         B     INDEXED                 RC 8 - INDEXED VTOC              00293
         B     NOMOUNT                 RC 12- VOL NOT MOUNTED           00294
         B     NODASD                  RC 16- NOT DASD                  00295
         ABEND 16                      JUST IN CASE                     00296
         EJECT                                                          00297
*********************************************************************   00298
*********************************************************************   00299
**                                                                 **   00300
**       SET UP BUFFER TO READ FIRST DSCB                          **   00301
**                                                                 **   00302
*********************************************************************   00303
*********************************************************************   00304
         SPACE                                                          00305
INDEXED  MVI   IXVTOC,C'1'             SET THIS IS INDEXED VTOC         00306
         SPACE                                                          00307
NOINDEX  BAL   R10,NEWPAGE             AND START A NEW PAGE             00308
         XC    BUFLIST(BFLHLN),BUFLIST CLEAR BUFFER LIST                00309
         XC    BFLE(BFLELN),BFLE       CLEAR BUFFER ENTRY               00310
         MVI   BFLHNOE,X'1'            NUMBER OF DSCBS TO BE READ = 1   00311
         OI    BFLHFL,BFLHDSCB         SET DSCBS AS ARGUMENT            00312
         OI    BFLEFL,BFLECHR          ARGUMENT IS CCHHR                00313
         MVI   BFLELTH,DSCBLTH         LENTGH OF DSCB                   00314
         XC    BFLEARG,BFLEARG         SET TO READ 1ST DSCB             00315
         LA    R3,DS1DSNAM             ADDR OF DSCB BUFFER              00316
         ST    R3,BFLEBUF              PLC ADDR OF DSCB BUFFER IN BFLE  00317
         EJECT                                                          00318
*********************************************************************   00319
*********************************************************************   00320
**                                                                 **   00321
**       READ THE DSCBS AND CHECK RETURN CODE.                     **   00322
**                                                                 **   00323
*********************************************************************   00324
*********************************************************************   00325
         SPACE                                                          00326
SEQLOOP  CVAFSEQ BRANCH=YES,MF=(E,CVPL),UCB=(R5)  GET A DSCB            00327
         SPACE                                                          00328
         LTR   R15,R15                 ANY ERROR?                       00329
         BZ    CKFMT1                     NO....CHECK FOR FORMAT 1      00330
         C     R15,=F'4'               RETURN CODE 4?                   00331
         SPACE                                                          00332
         BH    ABEND12                   NO...ABEND (RC=R15 AND CVSTAT) 00333
         CLI   CVSTAT,X'20'            END OF VTOC?                     00334
         SPACE                                                          00335
         BNE   ABEND12                   NO...ABEND (RC=R15 AND CVSTAT) 00336
         SR    R15,R15                   GIVE ZERO RETURN CODE          00337
         B     EOF                       YES..EOJ                       00338
         EJECT                                                          00339
*********************************************************************   00340
*********************************************************************   00341
**                                                                 **   00342
**       IS IT A FORMAT 1 DSCB?                                    **   00343
**       INITIALIZE PRINT LINE.                                    **   00344
**       GO READ NEXT DSCB IF NOT FORMAT 1.                        **   00345
**                                                                 **   00346
*********************************************************************   00347
*********************************************************************   00348
         SPACE                                                          00349
CKFMT1   CLC   DS1FMTID(1),FORMAT1     FORMAT 1 DSCB?                   00350
         BNE   SEQLOOP                    NO....GET ANOTHER DSCB        00351
         MVC   DSNAME(44),DS1DSNAM     MOVE DSN TO SYSPRINT             00352
         MVC   VOLSER(6),DS1DSSN       MOVE VOLSER TO SYSPRINT          00353
         MVC   STAT(2),=C'  '          SET DEFAULT NOT CHANGED          00354
         MVC   VCHG(11),=C'NOT CHANGED' SET DEFAULT VOLSER NOT CHANGED  00355
         MVC   RCHG(11),=C'NOT CHANGED' SET DEFAULT RACF   NOT CHANGED  00356
         CLI   FLAG,C'1'               DOING VOLSERS ONLY?              00357
         BE    CKDSCBV                    YES... GO CHECK DSCBS         00358
         CLI   FLAG,C'2'               DOING RACF ON ONLY?              00359
         BE    RACON                       YES... GO CHECK IT OUT       00360
         CLI   FLAG,C'3'               DOING RACF OFF ONLY?             00361
         BE    RACOFF                     YES... GO CHECK IT OUT        00362
         ABEND 8                       JUST IN CASE                     00363
         EJECT                                                          00364
*********************************************************************   00365
*********************************************************************   00366
**                                                                 **   00367
**       HERE WE ARE TURNING THE RACF INDICATOR OFF IF IT IS ON    **   00368
**                                                                 **   00369
*********************************************************************   00370
*********************************************************************   00371
         SPACE                                                          00372
RACOFF   TM    DS1DSORG+1,X'08'        VSAM?                            00373
         BO    PRINT                      YES.. DONT TOUCH              00374
         TM    DS1DSIND,X'40'          IS RACF BIT ON?                  00375
         BNO   PRINT                      NO... JUST PRINT              00376
         NI    DS1DSIND,X'BF'   TURN RACF BIT OFF, PRESERVE OTHER INFO  00377
         MVC   RCHG(11),=C'CHANGED    ' SAY WE CHANGED THE VOLSER       00378
         MVC   STAT(2),=C'**'          INDICATE CHANGED                 00379
         B     PRINTW                  BRANCH TO PRINT AND REWRITE      00380
         EJECT                                                          00381
*********************************************************************   00382
*********************************************************************   00383
**                                                                 **   00384
**       HERE WE ARE TURNING THE RACF INDICATOR ON IF IT IS OFF    **   00385
**                                                                 **   00386
*********************************************************************   00387
*********************************************************************   00388
         SPACE                                                          00389
RACON    TM    DS1DSORG+1,X'08'        VSAM?                            00390
         BO    PRINT                      YES.. DONT TOUCH              00391
         TM    DS1DSIND,X'40'          IS RACF BIT ON?                  00392
         BO    PRINT                      YES.. JUST PRINT              00393
         OI    DS1DSIND,X'40'          TURN RACF BIT ON                 00394
         MVC   RCHG(11),=C'CHANGED    ' SAY WE CHANGED THE VOLSER       00395
         MVC   STAT(2),=C'**'          INDICATE CHANGED                 00396
         B     PRINTW                  BRANCH TO PRINT AND REWRITE      00397
         EJECT                                                          00398
*********************************************************************   00399
*********************************************************************   00400
**                                                                 **   00401
**       HERE WE FIXING THE DSCB VOLSER IF IT IS INCORRECT         **   00402
**                                                                 **   00403
*********************************************************************   00404
*********************************************************************   00405
         SPACE                                                          00406
CKDSCBV  CLC   UCBVOLI,DS1DSSN         VOLSER MATCH?                    00407
         BNE   CHGV                       NO... BAD VOLSER, GO FIX IT   00408
         B     PRINT                   PRINT AND GET ANOTHER DSCB       00409
CHGV     MVC   DS1DSSN(6),UCBVOLI      MOVE IN CORRECT VOLSER           00410
         MVC   VCHG(11),=C'CHANGED    ' SAY WE CHANGED THE VOLSER       00411
         MVC   STAT(2),=C'**'          INDICATE VOLSER WAS CHANGED      00412
         B     PRINTW                  GO PRINT AND REWRITE             00413
         EJECT                                                          00414
*********************************************************************   00415
*********************************************************************   00416
**                                                                 **   00417
**       REWRITE THE DSCB IF WE HAVE CHANGED SOMETHING             **   00418
**                                                                 **   00419
*********************************************************************   00420
*********************************************************************   00421
         SPACE                                                          00422
REWRITE  MVI   BADSW,C'1'              WE HAVE CHANGED SOMETHING        00423
         USING CVPL,R1                                                  00424
         XR    R9,R9                   ZERO OUT REGISTER 9              00425
         LA    R9,DS1DSNAM             LOADING THE DSN OF BAD DSCB      00426
         XR    R8,R8                   ZERO OUT REGISTER 8              00427
         LA    R8,BUFLIST              LOADING THE ADDRESS OF BUFLIST   00428
         EJECT                                                          00429
         ENQ   (QNAME,VOLUME,E,6,SYSTEM)  ENQ THE VTOC                  00430
         SPACE 3                                                        00431
*        RESERVE (CNBVOL,RVOLUME,E,0,SYSTEMS),UCB=(R5) RESERVE IT       00432
         EJECT                                                          00433
         CVAFDIR ACCESS=WRITE,DSN=(R9),BUFLIST=(R8),                   X00434
               BRANCH=NO,UCB=(R5),IOAREA=NOKEEP,MAPRCDS=NO              00435
         EJECT                                                          00436
         DEQ   (QNAME,VOLUME,6,SYSTEM)    DEQ THE VTOC                  00437
         SPACE 3                                                        00438
*        DEQ   (CNBVOL,VOLUME,6,SYSTEMS),UCB=(R5) RELEASE THE VTOC      00439
         SPACE                                                          00440
         LTR   R15,R15                                                  00441
         BNZ   CHECKDIR                                                 00442
         B     SEQLOOP                                                  00443
         EJECT                                                          00444
*********************************************************************   00445
*********************************************************************   00446
**                                                                 **   00447
**       PRINT LOOP IF REWRITING THE DSCB                          **   00448
**                                                                 **   00449
*********************************************************************   00450
*********************************************************************   00451
         SPACE                                                          00452
PRINTW   CP    LINECTR,=PL2'53'        53 LINES?                        00453
         BNE   CONT1                       NO...CONTINUE                00454
         BAL   R10,NEWPAGE                 YES..GO DO NEW PAGE          00455
         SPACE                                                          00456
CONT1    AP    LINECTR,ONE             ADD ONE TO LINE COUNTER          00457
         PUT   SYSPRINT,PRINTLNE       PRINT THE LINE                   00458
         B     REWRITE                                                  00459
         EJECT                                                          00460
*********************************************************************   00461
*********************************************************************   00462
**                                                                 **   00463
**       PRINT LOOP IF NOT REWRITING THE DSCB                      **   00464
**                                                                 **   00465
*********************************************************************   00466
*********************************************************************   00467
         SPACE                                                          00468
PRINT    CP    LINECTR,=PL2'53'        FULL PAGE?                       00469
         BNE   CONT2                      NO... CONTINUE                00470
         BAL   R10,NEWPAGE                YES.. NEW PAGE                00471
         SPACE                                                          00472
CONT2    AP    LINECTR,ONE             ADD ONE TO LINE COUNTER          00473
         PUT   SYSPRINT,PRINTLNE       PRINT THE LINE                   00474
         B     SEQLOOP                 GO GET NEXT DSCB                 00475
         EJECT                                                          00476
*********************************************************************   00477
*********************************************************************   00478
**                                                                 **   00479
**       HAVE AND INVALID UCB.                                     **   00480
**                                                                 **   00481
*********************************************************************   00482
*********************************************************************   00483
         SPACE                                                          00484
BADUCB   WTO   'INVALID UCB',ROUTCDE=(11) NO...INDICATE INVALID UCB     00485
         L     R15,12                  SET BAD RETURN CODE              00486
         B     EOF                             AND RETURN               00487
         EJECT                                                          00488
*********************************************************************   00489
*********************************************************************   00490
**                                                                 **   00491
**       NO PARM SPECIFIED                                         **   00492
**                                                                 **   00493
*********************************************************************   00494
*********************************************************************   00495
         SPACE                                                          00496
NOPARM   WTO   'NO PARM SPECIFIED',ROUTCDE=(11)     YES..               00497
         L     R15,4                   SET BAD RETURN CODE              00498
         B     EOJ                            AND RETURN                00499
         EJECT                                                          00500
*********************************************************************   00501
*********************************************************************   00502
**                                                                 **   00503
**      BAD PARM SPECIFIED                                         **   00504
**                                                                 **   00505
*********************************************************************   00506
*********************************************************************   00507
         SPACE                                                          00508
BADPARM  WTO   'INVALID PARM SPECIFIED',ROUTCDE=(11)     YES..          00509
         L     R15,4                   SET BAD RETURN CODE              00510
         B     EOJ                            AND RETURN                00511
         EJECT                                                          00512
*********************************************************************   00513
*********************************************************************   00514
**                                                                 **   00515
**       ERROR VOLUME NOT MOUNTED.                                 **   00516
**                                                                 **   00517
*********************************************************************   00518
*********************************************************************   00519
         SPACE                                                          00520
NOMOUNT  WTO   'VOLUME NOT MOUNTED',ROUTCDE=(11)                        00521
         L     R15,8                              SET BAD RETURN CODE   00522
         B     EOF                                AND GO TO EOJ         00523
         EJECT                                                          00524
*********************************************************************   00525
*********************************************************************   00526
**                                                                 **   00527
**       ERROR FROM DSCB WRITE (CVAFDIR)                           **   00528
**                                                                 **   00529
*********************************************************************   00530
*********************************************************************   00531
         SPACE                                                          00532
CHECKDIR DS    0H                                                       00533
         WTO   'ERROR FROM CVAFDIR',ROUTCDE=(11)                        00534
         ABEND 10,DUMP                            ABEND                 00535
         EJECT                                                          00536
*********************************************************************   00537
*********************************************************************   00538
**                                                                 **   00539
**       ERROR VOLUME NOT DASD.                                    **   00540
**                                                                 **   00541
*********************************************************************   00542
*********************************************************************   00543
         SPACE                                                          00544
NODASD   WTO   'VOLUME NOT DASD',ROUTCDE=(11)                           00545
         L     R15,8                              SET BAD RETURN CODE   00546
         B     EOF                                AND GO TO EOJ         00547
         EJECT                                                          00548
*********************************************************************   00549
*********************************************************************   00550
**                                                                 **   00551
**       EOJ PROCESSING.                                           **   00552
**                                                                 **   00553
*********************************************************************   00554
*********************************************************************   00555
         SPACE                                                          00556
EOF      CLI   BADSW,C'1'              ANY BAD DSCB'S?                  00557
         BE    ENDIT                      YES..EOJ                      00558
         BAL   R10,NEWPAGE                NO...GO DO NEW PAGE           00559
         PUT   SYSPRINT,BLANKS                 PRINT BLANK LINE         00560
         PUT   SYSPRINT,NOBAD                  WRITE...NO UPDATES       00561
ENDIT    CLOSE SYSPRINT                CLOSE PRINT FILE                 00562
EOJ      ENDALL CODE=(15)              RETURN TO MVS WITH RETURN CODE   00563
         EJECT                                                          00564
*********************************************************************   00565
*********************************************************************   00566
**                                                                 **   00567
**       NEW PAGE ROUTINE.                                         **   00568
**                                                                 **   00569
*********************************************************************   00570
*********************************************************************   00571
         SPACE                                                          00572
NEWPAGE  AP    PAGECTR,ONE             ADD ONE TO PAGE COUNTER          00573
         MVC   PAGE,PATTERN            MOVE IN PAGE NUMBER PATTERN      00574
         ED    PAGE,PAGECTR            EDIT THE PAGE NUMBER IN          00575
         PUT   SYSPRINT,HEADER         PRINT HEADER                     00576
         PUT   SYSPRINT,BLANKS         PRINT BLANK LINE                 00577
         PUT   SYSPRINT,HEADER2        PRINT HEADER2                    00578
         PUT   SYSPRINT,UNDERL         UNDERLINE IT                     00579
         PUT   SYSPRINT,BLANKS         PRINT BLANK LINE                 00580
         SP    LINECTR,LINECTR         CLEAR LINE COUNTER               00581
         BR    R10                                                      00582
         EJECT                                                          00583
*********************************************************************   00584
*********************************************************************   00585
**                                                                 **   00586
**       SYSPRINT DCB                                              **   00587
**                                                                 **   00588
*********************************************************************   00589
*********************************************************************   00590
         SPACE                                                          00591
SYSPRINT DCB   DDNAME=SYSPRINT,DSORG=PS,LRECL=133,MACRF=PM,RECFM=FBA    00592
         EJECT                                                          00593
*********************************************************************   00594
*********************************************************************   00595
**                                                                 **   00596
**       NO ERRORS FOUND LINE.                                     **   00597
**                                                                 **   00598
*********************************************************************   00599
*********************************************************************   00600
         SPACE                                                          00601
NOBAD    DS   0CL133                                                    00602
         DC   C' '                                                      00603
         DC   CL132'NO DSCB''S CHANGED'                                 00604
         EJECT                                                          00605
*********************************************************************   00606
*********************************************************************   00607
**                                                                 **   00608
**       HEADER LINE.                                              **   00609
**                                                                 **   00610
*********************************************************************   00611
*********************************************************************   00612
         SPACE                                                          00613
HEADER   DS   0CL133                                                    00614
         DC   C'1'                                                      00615
         DC   CL15' '                                                   00616
         DC   C'STATUS OF DSCB CHANGES FOR VOLUME '                     00617
PVOL     DS   CL6                                                       00618
         DC   C' ON UNIT '                                              00619
PUNIT    DS   CL3                                                       00620
         DC   C' '                                                      00621
         DC   C'USING PARM VALUE - '                                    00622
PPARM    DS   CL6                                                       00623
         DC   CL15' '                                                   00624
         DC   C'PAGE '                                                  00625
PAGE     DS   CL2                                                       00626
         DC   CL20' '                                                   00627
         EJECT                                                          00628
*********************************************************************   00629
*********************************************************************   00630
**                                                                 **   00631
**       HEADER LINE 2                                             **   00632
**                                                                 **   00633
*********************************************************************   00634
*********************************************************************   00635
         SPACE                                                          00636
HEADER2  DS   0CL133                                                    00637
         DC   C' '                                                      00638
         DC   CL2' '                                                    00639
         DC   C' '                                                      00640
         DC   CL44'DATASET NAME'                                        00641
         DC   CL2' '                                                    00642
         DC   CL6'VOLSER'                                               00643
         DC   CL4' '                                                    00644
         DC   C'VOLSER CHANGE'                                          00645
         DC   CL6' '                                                    00646
         DC   C'RACF CHANGE'                                            00647
         DC   CL80' '                                                   00648
         EJECT                                                          00649
*********************************************************************   00650
*********************************************************************   00651
**                                                                 **   00652
**       UNDER LINE HEADER 2                                       **   00653
**                                                                 **   00654
*********************************************************************   00655
*********************************************************************   00656
         SPACE                                                          00657
UNDERL   DS   0CL133                                                    00658
         DC   C'+'                                                      00659
         DC   CL2' '                                                    00660
         DC   C' '                                                      00661
         DC   44C'_'                                                    00662
         DC   CL2' '                                                    00663
         DC   6C'_'                                                     00664
         DC   CL4' '                                                    00665
         DC   13C'_'                                                    00666
         DC   CL6' '                                                    00667
         DC   11C'_'                                                    00668
         DC   CL80' '                                                   00669
         EJECT                                                          00670
*********************************************************************   00671
*********************************************************************   00672
**                                                                 **   00673
**       PRINT  LINE.                                              **   00674
**                                                                 **   00675
*********************************************************************   00676
*********************************************************************   00677
         SPACE                                                          00678
PRINTLNE DS   0CL133                                                    00679
CC       DC   C' '                                                      00680
STAT     DS   CL2                                                       00681
         DC   C' '                                                      00682
DSNAME   DS   CL44                                                      00683
         DC   CL2' '                                                    00684
VOLSER   DS   CL6                                                       00685
         DC   CL4' '                                                    00686
VCHG     DS   CL11                                                      00687
         DC   CL8' '                                                    00688
RCHG     DS   CL11                                                      00689
         DC   CL80' '                                                   00690
         EJECT                                                          00691
*********************************************************************   00692
*********************************************************************   00693
**                                                                 **   00694
**       STORAGE AND CONSTANTS.                                    **   00695
**                                                                 **   00696
*********************************************************************   00697
*********************************************************************   00698
         SPACE                                                          00699
         DS  0F                                                         00700
QNAME    DC   CL8'SYSVTOC '                                             00701
         DS  0F                                                         00702
CNBVOL   DC   CL8'CNBVOL  '                                             00703
FLAG     DS   CL1                                                       00704
         DS  0F                                                         00705
RVOLUME  DS  0CL7                                                       00706
         DC   X'06'                                                     00707
VOLUME   DS   CL6                                                       00708
PAGECTR  DC   PL1'0'                                                    00709
LINECTR  DC   PL2'0'                                                    00710
ONE      DC   PL1'1'                                                    00711
PATTERN  DC   XL2'4021'                                                 00712
         EJECT                                                          00713
ABEND12  ABEND 12,DUMP                                                  00714
LISTSTRT DC    F'0'                    ADDR O FCCHHR TO START SEARCH    00715
LISTPRMS EQU   *                                                        00716
LISTBUF  DC    F'0'                                                     00717
LISTCHR  DS    0F                                                       00718
LISTLAST DC    X'00'                                                    00719
LASTBIT  EQU   X'80'                                                    00720
         DC    AL3(0)                                                   00721
LISTNEXT EQU   *                                                        00722
         EJECT                                                          00723
BADSW    DS    CL1                                                      00724
IXVTOC   DS    CL1                                                      00725
BLANKS   DC    CL133' '                                                 00726
FORMAT1  DC    C'1'                    FORMAT 1 DSCB                    00727
SAVE13   DC    F'0'                    IOSLOOK SAVE AREA                00728
IOSSAVE  DC    16F'0'                  IOSLOOK SAVE AREA                00729
ADDRWRK  DC    XL3'000000'             DEVICE ADDRESS WORK AREA         00730
HEX      DC    CL255' '                HEX TRANSLATE TABLE              00731
         ORG   HEX+C'0'                                                 00732
         DC    X'00010203040506070809' DIGITS 0-9                       00733
         ORG   HEX+C'A'                                                 00734
         DC    X'0A0B0C0D0E0F'         CHARS A-F                        00735
         ORG                                                            00736
         EJECT                                                          00737
*********************************************************************   00738
*********************************************************************   00739
**                                                                 **   00740
**       LITERALS                                                  **   00741
**                                                                 **   00742
*********************************************************************   00743
*********************************************************************   00744
         SPACE                                                          00745
         LTORG                                                          00746
         SPACE                                                          00747
         EJECT                                                          00748
*********************************************************************   00749
*********************************************************************   00750
**                                                                 **   00751
**       CVAF MAPPING MACRO                                        **   00752
**                                                                 **   00753
*********************************************************************   00754
*********************************************************************   00755
         SPACE                                                          00756
         LTORG                                                          00757
BUFLIST  ICVAFBFL DSECT=NO                                              00758
         EJECT                                                          00759
*********************************************************************   00760
*********************************************************************   00761
**                                                                 **   00762
**       FORMAT 1 DSCB MAPPING MACRO                               **   00763
**                                                                 **   00764
*********************************************************************   00765
*********************************************************************   00766
         SPACE                                                          00767
         IECSDSL1  (1)                                                  00768
DSCBLTH  EQU   *-IECSDSL1              LENGTH OF DSCB                   00769
         EJECT                                                          00770
*********************************************************************   00771
*********************************************************************   00772
**                                                                 **   00773
**       CVAFSEQ (NON-INDEXED VTOC)                                **   00774
**                                                                 **   00775
*********************************************************************   00776
*********************************************************************   00777
         SPACE                                                          00778
CVPL     CVAFSEQ ACCESS=GT,BRANCH=(YES,PGM),BUFLIST=BUFLIST,MF=L        00779
         ORG   CVPL                                                     00780
         EJECT                                                          00781
*********************************************************************   00782
*********************************************************************   00783
**                                                                 **   00784
**       CVPL MAPPING MACRO                                        **   00785
**                                                                 **   00786
*********************************************************************   00787
*********************************************************************   00788
         SPACE                                                          00789
CVPLMAP  ICVAFPL  DSECT=NO                                              00790
         EJECT                                                          00791
*********************************************************************   00792
*********************************************************************   00793
**                                                                 **   00794
**       CVT  MAPPING MACRO                                        **   00795
**                                                                 **   00796
*********************************************************************   00797
*********************************************************************   00798
         SPACE                                                          00799
         CVT   DSECT=YES                                                00800
         EJECT                                                          00801
*********************************************************************   00802
*********************************************************************   00803
**                                                                 **   00804
**    IOSLOOK MAPPING MACRO                                        **   00805
**                                                                 **   00806
*********************************************************************   00807
*********************************************************************   00808
         SPACE                                                          00809
         IECDIOCM                                                       00810
         EJECT                                                          00811
*********************************************************************   00812
*********************************************************************   00813
**                                                                 **   00814
**       UCB  MAPPING MACRO                                        **   00815
**                                                                 **   00816
*********************************************************************   00817
*********************************************************************   00818
         SPACE                                                          00819
         IEFUCBOB LIST=YES                                              00820
         END                                                            00821
